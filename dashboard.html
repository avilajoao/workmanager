<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue@3"></script>
  <link rel="stylesheet" href="assets/styles.css">
</head>
<body class="bg-gray-100 font-sans dark:bg-gray-900 dark:text-white">
  <div id="app" class="flex h-screen">
    <!-- Barra Lateral -->
    <aside class="w-64 bg-white shadow-md p-4 fixed top-0 left-0 h-full sidebar dark:bg-gray-800">
      <div class="flex flex-col space-y-4">
        <a href="index.html" class="px-4 py-2 rounded bg-gray-300 text-gray-600 dark:bg-gray-700 dark:text-white">Início</a>
        <a href="obras.html" class="px-4 py-2 rounded bg-gray-300 text-gray-600 dark:bg-gray-700 dark:text-white">O. Ativas</a>
      </div>
    </aside>

    <!-- Botão de Menu -->
    <div class="menu-tab">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
      </svg>
    </div>

    <!-- Conteúdo Principal -->
    <div class="flex-1 transition-all duration-300 content-center page-content">
      <header class="bg-white shadow-md p-4 flex justify-between items-center dark:bg-gray-800">
        <div class="flex items-center space-x-4">
          <h1 class="text-xl font-bold dark:text-white">Dashboard</h1>
        </div>
        <div class="relative flex items-center space-x-4">
          <button @click="toggleDarkMode" class="cursor-pointer">
            <svg v-if="isDarkMode" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-400 hover:text-yellow-500" fill="none" viewBox="0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
            </svg>
            <svg v-else xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
            </svg>
          </button>
          <svg @click="toggleSearch" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 cursor-pointer text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
          </svg>
          <input v-model="searchQuery" placeholder="Buscar por nome" :class="['absolute right-0 px-4 py-2 rounded border transition-all duration-300', isSearchExpanded ? 'w-48 opacity-100' : 'w-0 opacity-0']" class="bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-white search-input" @blur="collapseSearch"/>
        </div>
      </header>

      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-6 p-4">
        <div class="bg-white p-4 rounded shadow dark:bg-gray-800 dark:text-white">
          <p class="text-lg font-bold">Obras</p>
          <p class="text-xl font-semibold">{{ obras.length }}</p>
        </div>
        <div class="bg-white p-4 rounded shadow dark:bg-gray-800 dark:text-white">
          <p class="text-lg font-bold">Despesas do dia</p>
          <p class="text-xl font-semibold text-red-500">R$ 0,00</p>
        </div>
        <div class="bg-white p-4 rounded shadow dark:bg-gray-800 dark:text-white">
          <p class="text-lg font-bold">Receitas do dia</p>
          <p class="text-xl font-semibold text-green-500">R$ 0,00</p>
        </div>
        <div class="bg-white p-4 rounded shadow dark:bg-gray-800 dark:text-white">
          <p class="text-lg font-bold">Despesas em aberto</p>
          <p class="text-xl font-semibold text-red-500">R$ 275.021,95</p>
        </div>
        <div class="bg-white p-4 rounded shadow dark:bg-gray-800 dark:text-white">
          <p class="text-lg font-bold">Receitas em aberto</p>
          <p class="text-xl font-semibold text-green-500">R$ 5.500,00</p>
        </div>
        <div class="bg-white p-4 rounded shadow dark:bg-gray-800 dark:text-white">
          <p class="text-lg font-bold">Saúde financeira</p>
          <p class="text-xl font-semibold text-red-500">-R$ 1.322.838,92</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    const { createApp, ref, computed } = Vue;

    createApp({
      setup() {
        // Dados das obras
        const obras = ref([]);
        const profissionais = ref({});
        const times = ref([]);

        // Carregar dados do JSON
        fetch('obras.json')
          .then(response => response.json())
          .then(data => {
            obras.value = data.obras;
            profissionais.value = data.profissionais;
            times.value = data.times;
          });

        // Filtros e busca
        const searchQuery = ref('');
        const filterStatus = ref('active'); // 'active' ou 'inactive'
        const currentView = ref('obras'); // 'obras' ou 'dashboard'
        const isSidebarExpanded = ref(false); // Controla se a barra lateral está expandida
        const isSearchExpanded = ref(false); // Controla se a barra de pesquisa está expandida
        const isDarkMode = ref(localStorage.getItem('isDarkMode') === 'true'); // Estado do tema escuro
        const selectedObra = ref(null); // Obra selecionada para exibir detalhes

        // Aplicar o tema salvo ao carregar a página
        if (isDarkMode.value) {
          document.body.classList.add('dark');
        }

        // Filtragem
        const filteredObras = computed(() => {
          return obras.value
            .filter(obra => obra.status === filterStatus.value) // Filtra por status (ativa ou inativa)
            .filter(obra => obra.nome.toLowerCase().includes(searchQuery.value.toLowerCase()));
        });

        // Função para alternar entre obras ativas e inativas
        const toggleActiveInactive = () => {
          filterStatus.value = filterStatus.value === 'active' ? 'inactive' : 'active';
        };

        // Função para expandir/recolher a barra lateral
        const toggleSidebar = () => {
          isSidebarExpanded.value = !isSidebarExpanded.value;
        };

        // Função para expandir/recolher a barra de pesquisa
        const toggleSearch = () => {
          isSearchExpanded.value = !isSearchExpanded.value;
        };

        // Função para recolher a barra de pesquisa ao perder o foco
        const collapseSearch = () => {
          isSearchExpanded.value = false;
        };

        // Função para alternar entre os temas claro e escuro
        const toggleDarkMode = () => {
          isDarkMode.value = !isDarkMode.value;
          localStorage.setItem('isDarkMode', isDarkMode.value);
          document.body.classList.toggle('dark', isDarkMode.value);
        };

        // Função para exibir detalhes da obra
        const showDetails = (obra) => {
          const team = times.value.find(time => time.id === obra.time).membros;
          selectedObra.value = {
            ...obra,
            team: [
              { nome: profissionais.value.pedreiros.find(p => p.id === team.pedreiro).nome, role: 'Pedreiro' },
              ...team.ajudantes.map(id => ({ nome: profissionais.value.ajudantes.find(a => a.id === id).nome, role: 'Ajudante' })),
              { nome: profissionais.value.eletricistas.find(e => e.id === team.eletricista).nome, role: 'Eletricista' },
              { nome: profissionais.value.ajudantes_eletricos.find(ae => ae.id === team.ajudante_eletrico).nome, role: 'Ajudante Elétrico' }
            ]
          };
          currentView.value = 'detalhes';
        };

        return {
          obras,
          searchQuery,
          filterStatus,
          filteredObras,
          currentView,
          isSidebarExpanded,
          isSearchExpanded,
          isDarkMode,
          selectedObra,
          toggleActiveInactive,
          toggleSidebar,
          toggleSearch,
          collapseSearch,
          toggleDarkMode,
          showDetails,
        };
      },
    }).mount('#app');
  </script>
</body>
</html>